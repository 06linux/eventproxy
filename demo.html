<!DOCTYPE html>
<html>
<head>
<script src="event.emitter.js"></script>
</head>
<body>
<script>
var emitter = new EventEmitter();
emitter.await = function () {
    var callback = [].pop.apply(arguments, []);
    var args = [].slice.apply(arguments, [0, arguments.length]);
    var _map = {};

    for (var i = 0; i < args.length; i++) {
        (function (key) {
            _map[key] = {
                    "triggered" : false,
                    "data": null
                };
        }(args[i]));
    }
    emitter.on("all", function (eventName, data) {
        console.log("eventName: " + eventName);

        var trigger = true;
        var params = [];
        if (eventName in _map) {
            _map[eventName].triggered = true;
            _map[eventName].data = data;
        }

        for (var index in _map) {
            if (!_map[index].triggered) {
                trigger = false;
                break;
            } else {
                params.push(_map[index].data);
            }
        }

        if (trigger) {
            callback.apply(emitter, params);
        }
    });
};


emitter.await("hello", "world", function (data) {
    console.log("await");
    console.log(arguments);
});

setTimeout(function () {
    emitter.trigger("hello", {hello: "hello!"});
}, 5000);
setTimeout(function () {
    emitter.trigger("world", {world: "world!"});
}, 3000);
</script>
</body>
</html>